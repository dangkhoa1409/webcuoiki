<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <title>Quản lí người dùng</title>
</head>
<body>
    <style>
        .sidebar{
            max-width: 250px;
            min-width: 250px;
        }
        
        ul{
            list-style: none;
            padding-left: 10px;
        }

        .sidebar{
            transition: all 0.7s linear;
        }

        .sidebar-list:hover{
            background-color: rgba(0, 0, 0, 0.1);
        }   

        .search-icon{
            cursor: pointer;
        }
        .content{
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="wrapper" class="d-flex">
        <div class="sidebar d-md-block bg-secondary collapse navbar-collapse bg-dark" id="sidebar">
            <h2 class="text-white p-3 border-bottom border-secondary">Something</h2>
            <ul class="pl-0">
                <li class="sidebar-list py-2"><a class="d-block text-white text-decoration-none" href=""><i class="h4 ml-3 mr-4 fa-solid fa-calendar-days"></i>Dashboard</a></li>
                <li class="sidebar-list py-2"><a class="d-block text-white text-decoration-none" href="#"><i class="h4 ml-3 mr-4 fa-solid fa-chart-line"></i>Report</a></li>
                <li class="sidebar-list py-2"><a class="d-block text-white text-decoration-none" href="#"><i class="h4 ml-3 mr-4 fa-solid fa-rectangle-list"></i>User Management</a></li>
            </ul>
        </div>
        <div class="content w-100 bg-light">
            <nav class="bg-white w-100 px-3 py-2">
                <div class="row mx-0 bg-white">
                    <div class="d-flex justify-content-between">
                        <button type="button" class="btn text-white bg-white d-md-none navbar-toggler navbar-light" data-toggle="collapse" data-target="#sidebar">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    <div class="input-group border rounded d-none d-md-flex row ml-1">
                        <div class="col-11 px-0"><input type="text" class="form-control border-0" placeholder="Search Here" aria-label="Username" aria-describedby="basic-addon1">
                        </div>
                        <div class="input-group-prepend mt-1 col-1 pl-5 search-icon">
                          <span class="input-group-text bg-white border-0" id="basic-addon1"><i class="fa-solid fa-magnifying-glass"></i></span>
                        </div>
                    </div>
                </div>
            </nav>
            <table class="table">
                <thead>
                  <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Username</th>
                    <th scope="col">Password</th>
                    <th scope="col">Permission</th>
                    <th scope="col">Image</th>
                  </tr>
                </thead>
                <tbody>
                    
                </tbody>
            </table>
        </div>
    </div>

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
    <script>
        var arrEle;
        function loadData() {
            $(".table tbody").empty();
            //Sau khi update xong thi xoa thanh phan cu~ tren HTML
            $.ajax({
            url: "https://62b269f320cad3685c8db9c1.mockapi.io/farmManager",
            type: "GET",
            dataType: "json",
            success: function(data) {
                arrEle = data;
                let emptyStr = '';
                for(let i=0 ; i<data.length ; i++){
                    let edit = `<img id="edit" class="img" src="./stock-vector-add-user-or-add-item-positive-sign-line-art-vector-icon-for-apps-and-websites-1386189185.jpeg" alt="" onclick=edit(${data[i].id})>`;
                    let remove = `<img id="remove" class="img" src="./png-transparent-computer-icons-html-waste-bin-white-rectangle-logo.png" alt="" onclick=remove(${data[i].id})>`;
                    let strTemp = "<tr> <th scope='row'>" + data[i].id + "</th>"
                        + "<td>" + data[i].username + "</td>"
                        + "<td>" + data[i].password + "</td>"
                        + "<td>" + data[i].permission + "</td>"
                        + "<td>" + '<img src=" + data[i].image + " alt="">' + "</td>" //note
                        + "<td>" + edit + remove + "</td> </tr>";
                        emptyStr += strTemp;
                }
                $(".table tbody").append(emptyStr); //append : mở rộng 
                }
            });
        }
        $("#btnUpdate").click(function() {
            var objData = {};
            var id = $("#txtId").val();
            objData.name = $("#txtNameEdit").val();
            objData.action = $("#txtActionEdit").val();
            objData.time = $("#txtTimeEdit").val();

            var urlAPI = "https://627c7b6fe5ac2c452af0e74e.mockapi.io/Activity/";
            $.ajax({
                url: urlAPI + id,
                type: "PUT",
                data: objData,
                success: function(result) {
                    $("#editModal").hide();
                    loadData();
                }
            })
        });

        function remove(id) {
            $.ajax({
                url: "https://627c7b6fe5ac2c452af0e74e.mockapi.io/Activity/" + id,
                type: "DELETE",
                success: function(result) {
                    loadData();
                }
            })
        };



        //Lấy ra modal dữ liệu đã có sẵn
        function edit(id) {
            for(var i=0; i<arrEle.length; i++){
                if(arrEle[i].id == id){
                    //Khi ma trung id thi moi hien form 
                    $("#editModal").show();
                    $("#txtId").val(arrEle[i].id);
                    $("#txtNameEdit").val(arrEle[i].name);
                    $("#txtActionEdit").val(arrEle[i].action);
                    $("#txtTimeEdit").val(arrEle[i].time);
                    break;
                }
            }
        }

        function addClose() {
            $("#addModal").hide();
        }

        function editClose() {
            $("#editModal").hide();
        }

        function add() {
            $("#addModal").show();  
        }
        loadData();
    </script>
</body>
</html>